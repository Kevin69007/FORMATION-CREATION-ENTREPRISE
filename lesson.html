<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation Entrepreneuriat - Le√ßon</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="formation-layout">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="user-info" onclick="goToProfile()" style="cursor: pointer;">
                    <div class="user-avatar" id="userAvatar">KJ</div>
                    <div class="user-details">
                        <h3 id="userName">Kevin JEAN</h3>
                        <p>√âtudiant</p>
                    </div>
                </div>
                <div class="progress-info">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Progression</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <nav class="navigation" id="navigation">
                <!-- Navigation will be generated by JavaScript -->
            </nav>
            
            <!-- Lien vers le profil toujours visible -->
            <div style="padding: 20px 0; border-top: 1px solid #e1e5e9; margin-top: 20px;">
                <a href="profile.html" class="profile-link" style="display: flex; align-items: center; padding: 12px 20px; color: #667eea; text-decoration: none; border-radius: 8px; transition: background-color 0.3s; font-weight: 600;">
                    <span style="margin-right: 10px; font-size: 18px;">üë§</span>
                    Mon Profil
                </a>
            </div>

            <div style="padding: 20px;">
                <button onclick="logout()" style="width: 100%; padding: 10px; background: #dc3545; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    D√©connexion
                </button>
            </div>
        </div>

        <!-- Contenu principal -->
        <div class="main-content">
            <div class="content-header">
                <h1 class="content-title" id="lessonTitle">Titre de la le√ßon</h1>
                <p class="content-subtitle" id="moduleTitle">Module X</p>
            </div>

            <!-- Navigation de le√ßon -->
            <div class="lesson-nav">
                <button class="nav-button prev" id="prevButton" onclick="previousLesson()">
                    ‚Üê Pr√©c√©dent
                </button>
                
                <button class="complete-button" id="completeButton" onclick="markAsCompleted()">
                    Marquer comme termin√©
                </button>
                
                <button class="nav-button next" id="nextButton" onclick="nextLesson()">
                    Suivant ‚Üí
                </button>
            </div>

            <!-- Contenu de la le√ßon -->
            <div class="lesson-content" id="lessonContent">
                <!-- Le contenu sera charg√© dynamiquement -->
            </div>

            <!-- Navigation de le√ßon (en bas) -->
            <div class="lesson-nav">
                <button class="nav-button prev" id="prevButtonBottom" onclick="previousLesson()">
                    ‚Üê Pr√©c√©dent
                </button>
                
                <button class="complete-button" id="completeButtonBottom" onclick="markAsCompleted()">
                    Marquer comme termin√©
                </button>
                
                <button class="nav-button next" id="nextButtonBottom" onclick="nextLesson()">
                    Suivant ‚Üí
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script src="lesson-content-module1.js"></script>
    <script src="lesson-content-module2.js"></script>
    <script src="lesson-content-module3.js"></script>
    <script src="lesson-content-module4.js"></script>
    <script src="lesson-content-module5.js"></script>
    <script src="lesson-content-module6.js"></script>
    <script src="lesson-content-module7.js"></script>
    <script src="lesson-content-module8.js"></script>
    <script src="lesson-content-module9.js"></script>
    <script src="lesson-content-module10.js"></script>
    <script src="lesson-content-module11.js"></script>
    <script src="lesson-content-module12.js"></script>
    <script src="lesson-content-module13.js"></script>
    <script>
        // Variables globales pour la le√ßon actuelle (AVANT toute autre fonction)
        let currentModule = parseInt(getUrlParameter('module')) || 1;
        let currentLesson = parseInt(getUrlParameter('lesson')) || 1;
        
        // Fonction utilitaire d√©plac√©e en haut
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // Attendre que tous les scripts soient charg√©s
        window.addEventListener('load', function() {
            console.log('Tous les scripts charg√©s, initialisation...');
            
            // Debug: v√©rifier les modules charg√©s
            console.log('Modules disponibles:', {
                module1Content: typeof window.module1Content,
                module2Content: typeof window.module2Content,
                module3Content: typeof window.module3Content,
                module4Content: typeof window.module4Content,
                module5Content: typeof window.module5Content
            });
            
            console.log('Variables globales:', {
                currentModule: currentModule,
                currentLesson: currentLesson
            });
            
            // V√©rifier l'authentification
            checkAuth();
            
            // Initialiser la le√ßon
            initializeLesson();
        });
        
        function initializeLesson() {
            console.log(`Initialisation le√ßon: Module ${currentModule}, Le√ßon ${currentLesson}`);
            
            // Charger la navigation
            generateNavigation();
            
            // Charger le contenu de la le√ßon
            loadLessonContent();
            
            // Mettre √† jour l'√©tat des boutons
            updateNavigationButtons();
            
            // Mettre √† jour la progression
            updateProgress();
        }
        
        function loadLessonContent() {
            console.log('Chargement du contenu...');
            
            const lesson = getLessonData(currentModule, currentLesson);
            console.log('Donn√©es de la le√ßon r√©cup√©r√©es:', lesson);
            
            if (lesson && lesson.content && lesson.content.trim().length > 0) {
                console.log('Affichage du contenu...');
                document.getElementById('lessonTitle').textContent = lesson.title;
                document.getElementById('moduleTitle').textContent = lesson.moduleTitle;
                document.getElementById('lessonContent').innerHTML = lesson.content;
            } else {
                console.error('Aucun contenu trouv√© pour cette le√ßon');
                document.getElementById('lessonTitle').textContent = 'Erreur de chargement';
                document.getElementById('moduleTitle').textContent = `Module ${currentModule}`;
                document.getElementById('lessonContent').innerHTML = `
                    <h1>Contenu non trouv√©</h1>
                    <p>Impossible de charger le contenu pour le module ${currentModule}, le√ßon ${currentLesson}.</p>
                    <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h4>Informations de debug :</h4>
                        <ul>
                            <li>Module demand√© : ${currentModule}</li>
                            <li>Le√ßon demand√©e : ${currentLesson}</li>
                            <li>window.module${currentModule}Content existe : ${typeof window['module' + currentModule + 'Content']}</li>
                        </ul>
                    </div>
                `;
            }
        }
        
        function markAsCompleted() {
            const lessonKey = `module_${currentModule}_lesson_${currentLesson}`;
            
            // Marquer comme termin√© dans le localStorage
            let progress = JSON.parse(localStorage.getItem('lessonProgress') || '{}');
            progress[lessonKey] = {
                completed: true,
                completedAt: new Date().toISOString()
            };
            localStorage.setItem('lessonProgress', JSON.stringify(progress));
            
            // Envoyer les donn√©es au serveur
            sendProgressToServer();
            
            // Mettre √† jour l'interface
            updateProgress();
            generateNavigation();
            
            // Changer les boutons
            const completeButton = document.getElementById('completeButton');
            const completeButtonBottom = document.getElementById('completeButtonBottom');
            completeButton.textContent = '‚úì Termin√©';
            completeButton.style.background = '#28a745';
            completeButton.disabled = true;
            
            completeButtonBottom.textContent = '‚úì Termin√©';
            completeButtonBottom.style.background = '#28a745';
            completeButtonBottom.disabled = true;
            
            // Notification
            showNotification('Le√ßon marqu√©e comme termin√©e !');
        }
        
        function previousLesson() {
            const prevLesson = getPreviousLesson(currentModule, currentLesson);
            if (prevLesson) {
                window.location.href = `lesson.html?module=${prevLesson.module}&lesson=${prevLesson.lesson}`;
            }
        }
        
        function nextLesson() {
            const nextLesson = getNextLesson(currentModule, currentLesson);
            if (nextLesson) {
                window.location.href = `lesson.html?module=${nextLesson.module}&lesson=${nextLesson.lesson}`;
            }
        }
        
        function updateNavigationButtons() {
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const completeButton = document.getElementById('completeButton');
            
            // Boutons du bas
            const prevButtonBottom = document.getElementById('prevButtonBottom');
            const nextButtonBottom = document.getElementById('nextButtonBottom');
            const completeButtonBottom = document.getElementById('completeButtonBottom');
            
            // V√©rifier si la le√ßon est d√©j√† termin√©e
            const lessonKey = `module_${currentModule}_lesson_${currentLesson}`;
            const progress = JSON.parse(localStorage.getItem('lessonProgress') || '{}');
            const isCompleted = progress[lessonKey] && progress[lessonKey].completed;
            
            // R√©initialiser les boutons de compl√©tion
            completeButton.textContent = 'Marquer comme termin√©';
            completeButton.style.background = '#007bff';
            completeButton.disabled = false;
            
            completeButtonBottom.textContent = 'Marquer comme termin√©';
            completeButtonBottom.style.background = '#007bff';
            completeButtonBottom.disabled = false;
            
            if (isCompleted) {
                completeButton.textContent = '‚úì Termin√©';
                completeButton.style.background = '#28a745';
                completeButton.disabled = true;
                
                completeButtonBottom.textContent = '‚úì Termin√©';
                completeButtonBottom.style.background = '#28a745';
                completeButtonBottom.disabled = true;
            }
            
            // G√©rer les boutons de navigation
            const prevLesson = getPreviousLesson(currentModule, currentLesson);
            const nextLesson = getNextLesson(currentModule, currentLesson);
            
            if (!prevLesson) {
                prevButton.disabled = true;
                prevButton.style.display = 'none';
                prevButtonBottom.disabled = true;
                prevButtonBottom.style.display = 'none';
            } else {
                prevButton.disabled = false;
                prevButton.style.display = 'block';
                prevButtonBottom.disabled = false;
                prevButtonBottom.style.display = 'block';
            }
            
            if (!nextLesson) {
                nextButton.disabled = true;
                nextButton.style.display = 'none';
                nextButtonBottom.disabled = true;
                nextButtonBottom.style.display = 'none';
            } else {
                nextButton.disabled = false;
                nextButton.style.display = 'block';
                nextButtonBottom.disabled = false;
                nextButtonBottom.style.display = 'block';
            }
        }
        
        function showNotification(message) {
            // Cr√©er une notification temporaire
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 15px 20px;
                border-radius: 6px;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }
        
        function downloadPDF(filename) {
            // Cr√©er le t√©l√©chargement de PDF
            const link = document.createElement('a');
            link.href = `assets/pdfs/${filename}`;
            link.download = filename;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('T√©l√©chargement en cours...');
        }
        
        
        function goToProfile() {
            window.location.href = 'profile.html';
        }
    </script>
</body>
</html>